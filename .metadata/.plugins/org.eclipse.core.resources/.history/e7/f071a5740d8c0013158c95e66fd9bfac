package com.tvergilio.googleit;

import java.io.InputStream;
import java.net.HttpURLConnection;

import org.apache.http.HttpResponse;
import org.apache.http.client.HttpClient;
import org.apache.http.client.methods.HttpGet;

import android.app.Activity;
import android.os.AsyncTask;

public class UpdateWordTask extends AsyncTask<String, Void, Word[]> {
	private static final String BASE_URL = "http://google.com/complete/search?output=toolbar&q=";
	private HttpURLConnection connection;
	private Activity activity;
	private static final int PARSER_KIND_SAX = 0;
	private static final int PARSER_KIND_XMLPULL = 1;
	private static final int PARSER_KIND_JSON = 2;
	private int parserKind = PARSER_KIND_SAX;
	private Word[] words;

	public UpdateWordTask(Activity activity) {
		this.activity = activity;
	}

	@Override
	protected Word[] doInBackground(String... names) {
		try {
			String NAME = names[0];
			HttpClient httpClient = GoogleSuggestManagerService.getHttpClient();
			String format = parserKind == PARSER_KIND_JSON ? "json" : "xml";
			HttpGet request = new HttpGet(BASE_URL + NAME);
			HttpResponse response = httpClient.execute(request);
			InputStream data = response.getEntity().getContent();
			switch (parserKind) {
			case PARSER_KIND_SAX:
			return SAXWordParser.parseMovie(data);
			case PARSER_KIND_XMLPULL:
			return XmlPullWordParser.parseMovie(data);
			case PARSER_KIND_JSON:
				return JsonWordParser.parseMovie(data);
			default:
			throw new RuntimeException("unsupported parser");
			}
			} catch (Exception e) {
			e.printStackTrace();
			return null;
			}
			}
		return null;
	}

}
